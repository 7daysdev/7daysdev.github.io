<!DOCTYPE html>

<html lang="en">



<head>

Â  Â  <meta charset="UTF-8">

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">

Â  Â  <title>Card Collection - Refactor 4</title>

Â  Â  <link rel="stylesheet" href="styles.css">

Â  Â  <link rel="stylesheet" href="card-styles.css">

Â  Â  </head>



<body>

Â  Â  <button class="theme-toggle" id="themeToggle">ğŸŒ™</button>



Â  Â  <div class="container">

Â  Â  Â  Â  <h1>Card Collection Manager</h1>



Â  Â  Â  Â  <div class="header-actions">

Â  Â  Â  Â  Â  Â  <a href="index.html" class="btn">â† Back to Hub</a>

Â  Â  Â  Â  Â  Â  <div class="stats-container">

Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-item">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-label">Total Cards:</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-value" id="totalCards">0</span>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="filter-container" id="rarityFilters">

Â  Â  Â  Â  Â  Â  Â  Â  <button class="filter-btn active" data-rarity="all">All</button>

Â  Â  Â  Â  Â  Â  Â  Â  <button class="filter-btn" data-rarity="Common">Common</button>

Â  Â  Â  Â  Â  Â  Â  Â  <button class="filter-btn" data-rarity="Uncommon">Uncommon</button>

Â  Â  Â  Â  Â  Â  Â  Â  <button class="filter-btn" data-rarity="Rare">Rare</button>

Â  Â  Â  Â  Â  Â  Â  Â  <button class="filter-btn" data-rarity="Epic">Epic</button>

Â  Â  Â  Â  Â  Â  Â  Â  <button class="filter-btn" data-rarity="Ultimate">Ultimate</button>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <a href="cardCreator.html" class="btn">Create Card</a>

Â  Â  Â  Â  </div>



Â  Â  Â  Â  <h2 style="text-align: center;">Your Trading Cards</h2>

Â  Â  Â  Â  <div id="cards-container" class="card-grid">

Â  Â  Â  Â  Â  Â  <p class="loading">Loading cards...</p>

Â  Â  Â  Â  </div>

Â  Â  </div>



<script>

Â  Â  // Filter functionality

Â  Â  let currentRarityFilter = 'all';

Â  Â  let allCardsData = [];



Â  Â  // --- NEW: Function to accurately determine column count ---

Â  Â  function getGridColumnCount() {

Â  Â  Â  Â  const gridElement = document.getElementById('cards-container');

Â  Â  Â  Â  if (!gridElement) return 1;



Â  Â  Â  Â  // Ensure the grid has rendered by making sure it has children (or is visible)

Â  Â  Â  Â  if (gridElement.children.length === 0) {

Â  Â  Â  Â  Â  Â  // Fallback for initial load if the container is empty, but grid styles are applied

Â  Â  Â  Â  Â  Â  const style = window.getComputedStyle(gridElement);

Â  Â  Â  Â  Â  Â  // This is the most reliable check: it computes the actual column count.

Â  Â  Â  Â  Â  Â  const gridTemplateColumns = style.getPropertyValue('grid-template-columns');

Â  Â  Â  Â  Â  Â  if (gridTemplateColumns) {

Â  Â  Â  Â  Â  Â  Â  Â  Â // Counts the number of defined columns

Â  Â  Â  Â  Â  Â  Â  Â  Â return gridTemplateColumns.split(' ').length;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  // If cards are already present, we can compute the column count by looking at layout

Â  Â  Â  Â  // This is a robust way to check rendered column count, even in a dynamic grid.

Â  Â  Â  Â  if (gridElement.children.length > 0) {

Â  Â  Â  Â  Â  Â  const firstCard = gridElement.children[0];

Â  Â  Â  Â  Â  Â  const secondCard = gridElement.children[1];



Â  Â  Â  Â  Â  Â  if (firstCard && secondCard) {

Â  Â  Â  Â  Â  Â  Â  Â  // If the second card is directly below the first one, we only have one column.

Â  Â  Â  Â  Â  Â  Â  Â  // Otherwise, the number of columns is the index of the first card in the second row.

Â  Â  Â  Â  Â  Â  Â  Â  // Since this is difficult to track accurately, we'll rely on the initial computed style

Â  Â  Â  Â  Â  Â  Â  Â  // or a simpler measurement after all cards are appended.



Â  Â  Â  Â  Â  Â  Â  Â  // For a dynamic 'auto-fill' grid, the simplest effective method is the initial style check:

Â  Â  Â  Â  Â  Â  Â  Â  const style = window.getComputedStyle(gridElement);

Â  Â  Â  Â  Â  Â  Â  Â  const gridTemplateColumns = style.getPropertyValue('grid-template-columns');

Â  Â  Â  Â  Â  Â  Â  Â  if (gridTemplateColumns) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return gridTemplateColumns.split(' ').length;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  // Final fallback

Â  Â  Â  Â  return 4; // Assume 4 columns as a common desktop size

Â  Â  }





Â  Â  // --- Intersection Observer setup (unchanged, but disconnect added for safety) ---

Â  Â  let cardObserver;



Â  Â  function handleIntersection(entries, observer) {

Â  Â  Â  Â  entries.forEach(entry => {

Â  Â  Â  Â  Â  Â  if (entry.isIntersecting) {

Â  Â  Â  Â  Â  Â  Â  Â  entry.target.querySelector('.flip-card-inner').classList.remove('initial-back');

Â  Â  Â  Â  Â  Â  Â  Â  observer.unobserve(entry.target);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  });

Â  Â  }



Â  Â  function setupScrollFlipObserver() {

Â  Â  Â  Â  const options = {

Â  Â  Â  Â  Â  Â  root: null,

Â  Â  Â  Â  Â  Â  rootMargin: '0px 0px -100px 0px',

Â  Â  Â  Â  Â  Â  threshold: 0.1

Â  Â  Â  Â  };



Â  Â  Â  Â  if (cardObserver) {

Â  Â  Â  Â  Â  Â  Â cardObserver.disconnect();

Â  Â  Â  Â  }

Â  Â  Â  Â  cardObserver = new IntersectionObserver(handleIntersection, options);

Â  Â  Â  Â Â 

Â  Â  Â  Â  document.querySelectorAll('.flip-card').forEach(card => {

Â  Â  Â  Â  Â  Â  cardObserver.observe(card);

Â  Â  Â  Â  });

Â  Â  }

Â  Â  // ----------------------------------------



Â  Â  // ... (Keep all your existing setup functions and global variables) ...



// ----------------------------------------------------------------------

// ğŸŒŸ NEW FUNCTION: Get the ACTUAL column count from the rendered grid

// ----------------------------------------------------------------------

function getActualColumnCount(gridElement) {

Â  Â  if (!gridElement) return 4;Â 

Â  Â Â 

Â  Â  // Use requestAnimationFrame to ensure the grid has been laid out

Â  Â  return new Promise(resolve => {

Â  Â  Â  Â  requestAnimationFrame(() => {

Â  Â  Â  Â  Â  Â  const style = window.getComputedStyle(gridElement);

Â  Â  Â  Â  Â  Â  // This property will contain a space-separated list of column track sizes (e.g., "300px 300px 300px")

Â  Â  Â  Â  Â  Â  const gridTemplateColumns = style.getPropertyValue('grid-template-columns');

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  if (gridTemplateColumns && gridTemplateColumns.trim()) {

Â  Â  Â  Â  Â  Â  Â  Â  // Count the number of column track definitions

Â  Â  Â  Â  Â  Â  Â  Â  const columnCount = gridTemplateColumns.trim().split(/\s+/).length;

Â  Â  Â  Â  Â  Â  Â  Â  resolve(Math.max(1, columnCount));

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  // Fallback if measurement fails

Â  Â  Â  Â  Â  Â  Â  Â  resolve(4);Â 

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  });

Â  Â  });

}





async function loadCards(rarityFilter = 'all') {

Â  Â  try {

Â  Â  Â  Â  const response = await fetch('./card.json');

Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  const cardsContainer = document.getElementById('cards-container');

Â  Â  Â  Â Â 

Â  Â  Â  Â  // Clear container first to prepare for new elements

Â  Â  Â  Â  cardsContainer.innerHTML = '';Â 



Â  Â  Â  Â  allCardsData = data.cards || [];

Â  Â  Â  Â  let filteredCards = allCardsData;

Â  Â  Â  Â  if (rarityFilter !== 'all') {

Â  Â  Â  Â  Â  Â  filteredCards = allCardsData.filter(card => card.rarity === rarityFilter);

Â  Â  Â  Â  }



Â  Â  Â  Â  if (filteredCards.length > 0) {

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  // ----------------------------------------------------

Â  Â  Â  Â  Â  Â  // STEP 1: Render all cards WITHOUT delays first

Â  Â  Â  Â  Â  Â  // ----------------------------------------------------

Â  Â  Â  Â  Â  Â  filteredCards.forEach(card => {

Â  Â  Â  Â  Â  Â  Â  Â  const flipCard = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  flipCard.className = 'flip-card';

Â  Â  Â  Â  Â  Â  Â  Â  // Temporarily set delay to 0 or leave blank

Â  Â  Â  Â  Â  Â  Â  Â  flipCard.style.setProperty('--card-delay-offset', 0);Â 



Â  Â  Â  Â  Â  Â  Â  Â  const rarityClass = card.rarity ? card.rarity.toLowerCase() : 'common';

Â  Â  Â  Â  Â  Â  Â  Â  let typeDisplay = Array.isArray(card.type) ? card.type.join(' | ') : (typeof card.type === 'string' ? card.type.replace(/ /g, ' | ') : 'N/A');

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const imageFilename = card.image_filename || '';

Â  Â  Â  Â  Â  Â  Â  Â  const imagePath = `Cards/${imageFilename}`;

Â  Â  Â  Â  Â  Â  Â  Â  const backImagePath = 'Cards/Back.png';



Â  Â  Â  Â  Â  Â  Â  Â  const frontImage = imageFilename ?

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `<img src="${imagePath}" alt="${card.card_name}" class="card-image" onerror="this.src='${backImagePath}'">` :

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `<img src="${backImagePath}" alt="Card Back" class="card-image">`;



Â  Â  Â  Â  Â  Â  Â  Â  flipCard.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flip-card-inner initial-back ${rarityClass}-glow">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flip-card-front">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${frontImage}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-info">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>${card.card_name}</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>ID:</strong> ${card.card_id}</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Rarity:</strong> <span class="${rarityClass}">${card.rarity}</span></p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Type:</strong> ${typeDisplay}</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flip-card-back">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${backImagePath}" alt="Card Back" class="card-image">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  flipCard.addEventListener('click', function () {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = `card-detail.html?cardId=${card.card_id}`;

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  cardsContainer.appendChild(flipCard);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  // ----------------------------------------------------

Â  Â  Â  Â  Â  Â  // STEP 2: Measure the grid and apply the diagonal delay

Â  Â  Â  Â  Â  Â  // ----------------------------------------------------

Â  Â  Â  Â  Â  Â  const actualColumnCount = await getActualColumnCount(cardsContainer);

Â  Â  Â  Â  Â  Â  const allFlipCards = cardsContainer.querySelectorAll('.flip-card');

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  allFlipCards.forEach((flipCard, index) => {

Â  Â  Â  Â  Â  Â  Â  Â  const colIndex = index % actualColumnCount;

Â  Â  Â  Â  Â  Â  Â  Â  const rowIndex = Math.floor(index / actualColumnCount);

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  // Row + Col sum ensures the diagonal wave effect

Â  Â  Â  Â  Â  Â  Â  Â  const delayOffset = rowIndex + colIndex;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  // Re-set the CSS variable with the correct offset

Â  Â  Â  Â  Â  Â  Â  Â  flipCard.style.setProperty('--card-delay-offset', delayOffset);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  // Setup observer after all delays are calculated

Â  Â  Â  Â  Â  Â  setupScrollFlipObserver();



Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â cardsContainer.innerHTML = '<p class="error">No cards found. Add your first card!</p>';

Â  Â  Â  Â  }



Â  Â  Â  Â  // ... (rest of the stats/tooltip update code is unchanged and runs here) ...

Â  Â  Â  Â  const totalCardsElement = document.getElementById('totalCards');

Â  Â  Â  Â  totalCardsElement.textContent = filteredCards.length;

Â  Â  Â  Â  // ... (remaining stats/tooltip logic) ...



Â  Â  } catch (error) {

Â  Â  Â  Â  console.error('Failed to load cards:', error);

Â  Â  Â  Â  document.getElementById('cards-container').innerHTML = '<p class="error">Error loading cards. Make sure card.json exists.</p>';

Â  Â  }

}



// ... (Keep the rest of your DOMContentLoaded event listeners) ...



Â  Â  // Add filter button event listeners (unchanged)

Â  Â  document.addEventListener('DOMContentLoaded', function () {

Â  Â  Â  Â  const filterButtons = document.querySelectorAll('.filter-btn');



Â  Â  Â  Â  filterButtons.forEach(button => {

Â  Â  Â  Â  Â  Â  button.addEventListener('click', function () {

Â  Â  Â  Â  Â  Â  Â  Â  const rarity = this.getAttribute('data-rarity');

Â  Â  Â  Â  Â  Â  Â  Â  filterButtons.forEach(btn => btn.classList.remove('active'));

Â  Â  Â  Â  Â  Â  Â  Â  this.classList.add('active');

Â  Â  Â  Â  Â  Â  Â  Â  currentRarityFilter = rarity;

Â  Â  Â  Â  Â  Â  Â  Â  loadCards(rarity);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  });



Â  Â  Â  Â  // Add an initial resize listener to handle a better column count on resize

Â  Â  Â  Â  window.addEventListener('resize', () => {

Â  Â  Â  Â  Â  Â  Â loadCards(currentRarityFilter); // Reload all cards on resize to fix the staggered effect

Â  Â  Â  Â  });

Â  Â  });



Â  Â  // Load cards when page loads

Â  Â  loadCards();

</script>

</body>



</html>
