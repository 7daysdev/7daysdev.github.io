<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spells Index</title>
    <style>
        /* Base styles from hub, adapted */
        body {
            background-color: #1a1a1a;
            color: white;
            font-family: sans-serif;
            padding: 20px;
        }
        .spells-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .spells-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .spell-card {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #444;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, border-color 0.3s ease;
            display: flex; /* Added for footer alignment */
            flex-direction: column; /* Added for footer alignment */
        }
        .spell-card:hover {
            transform: translateY(-3px);
            border-color: #e6e600; /* Gold/Magic highlight */
        }
        .spell-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .spell-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .spell-name {
            font-size: 1.4rem;
            font-weight: bold;
            color: #ffd700; /* Gold */
        }
        .spell-rank {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: bold;
            background-color: #333;
            color: #fff;
        }
        .spell-school {
            font-size: 0.9rem;
            color: #ccc;
            margin-bottom: 10px;
            padding: 3px 6px;
            border-radius: 4px;
            display: inline-block;
            background-color: rgba(0, 123, 255, 0.2);
        }
        .spell-description {
            color: #bbb;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }
        .spell-effects {
            font-style: italic;
            font-size: 0.85rem;
            color: #888;
            border-top: 1px dashed #444;
            padding-top: 10px;
            margin-bottom: 15px; /* Added spacing */
        }

        /* --- New Detail Styles --- */
        .spell-footer {
            margin-top: auto; /* Pushes footer to the bottom */
            padding-top: 10px;
            border-top: 2px solid #555;
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        .detail-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .detail-item strong {
            font-size: 1.1rem;
            color: #fff;
            line-height: 1.2;
        }
        .detail-item span {
            font-size: 0.75rem;
            color: #aaa;
            text-transform: uppercase;
        }
        
        /* Filter Styles (kept same) */
        .filter-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #222;
            border-radius: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .filter-controls label, .filter-controls select {
            font-size: 1rem;
        }
        .filter-controls select {
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #555;
            background-color: #333;
            color: white;
            cursor: pointer;
        }
        
    </style>
</head>

<body>
    <div class="spells-container">
        <h1 style="text-align: center; margin-bottom: 10px;">✨ Spell Catalog ✨</h1>
        <p style="text-align: center; color: #ccc; margin-bottom: 40px;">Browse and filter the various schools of magic and ranks.</p>
        
        <div class="filter-controls">
            <div>
                <label for="school-filter">Filter by School:</label>
                <select id="school-filter" onchange="filterSpells()">
                    <option value="All">All Schools</option>
                    <option value="Ice">Ice</option>
                    <option value="Festive">Festive</option>
                    <option value="Food">Food</option>
                </select>
            </div>
            <div>
                <label for="rank-filter">Filter by Rank:</label>
                <select id="rank-filter" onchange="filterSpells()">
                    <option value="All">All Ranks</option>
                    <option value="B">Beginner (B)</option>
                    <option value="In">Intermediate (In)</option>
                    <option value="A">Advanced (A)</option>
                    <option value="U">Ultimate (U)</option>
                </select>
            </div>
        </div>

        <div class="spells-grid" id="spellsGrid">
            </div>
    </div>

    <script>
        let allSpells = []; // To store the fetched data globally

        async function fetchSpells() {
            try {
                // IMPORTANT: Ensure 'magic.json' is in the correct location
                const response = await fetch('magic.json'); 
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                allSpells = await response.json();
                displaySpells(allSpells); // Display all spells initially
            } catch (error) {
                console.error("Could not fetch spells data:", error);
                document.getElementById('spellsGrid').innerHTML = '<p>Error loading spells data. Check the console for details.</p>';
            }
        }

        // Function to generate and display spell cards - MODIFIED
        function displaySpells(spells) {
            const grid = document.getElementById('spellsGrid');
            grid.innerHTML = ''; // Clear existing content

            spells.forEach(spell => {
                const card = document.createElement('div');
                card.className = 'spell-card';
                
                // Set custom color for Ultimate spells
                let rankColor = '#fff';
                if (spell.rank_abbr === 'B') rankColor = '#66c2ff'; // Light Blue
                if (spell.rank_abbr === 'In') rankColor = '#90ee90'; // Light Green
                if (spell.rank_abbr === 'A') rankColor = '#ffa07a'; // Light Salmon
                if (spell.rank_abbr === 'U') rankColor = '#ffd700'; // Gold

                // Helper function to show requirement only if it's > 0
                const intReq = spell.stat_req_int > 0 
                    ? `<div class="detail-item"><strong>${spell.stat_req_int}</strong><span>Int</span></div>`
                    : '';
                const faiReq = spell.stat_req_fai > 0 
                    ? `<div class="detail-item"><strong>${spell.stat_req_fai}</strong><span>Fai</span></div>`
                    : '';

                card.innerHTML = `
                    <div class="spell-icon">${spell.icon}</div>
                    <div class="spell-header">
                        <h3 class="spell-name">${spell.name}</h3>
                        <span class="spell-rank" style="background-color: ${rankColor}; color: #1a1a1a;">${spell.rank_abbr}</span>
                    </div>
                    <span class="spell-school">${spell.school} Magic</span>
                    <p class="spell-description">${spell.description}</p>
                    <p class="spell-effects">Effects: ${spell.effects}</p>
                    
                    <div class="spell-footer">
                        <div class="detail-item">
                            <strong>${spell.mana_cost}</strong>
                            <span>FP Cost</span>
                        </div>
                        ${intReq}
                        ${faiReq}
                    </div>
                `;
                grid.appendChild(card);
            });

            if (spells.length === 0) {
                grid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: #aaa;">No spells match the current filter criteria.</p>';
            }
        }

        // Function to filter spells based on dropdown selections (Unchanged)
        function filterSpells() {
            const schoolFilter = document.getElementById('school-filter').value;
            const rankFilter = document.getElementById('rank-filter').value;

            const filtered = allSpells.filter(spell => {
                const passesSchool = (schoolFilter === 'All' || spell.school === schoolFilter);
                const passesRank = (rankFilter === 'All' || spell.rank_abbr === rankFilter);
                return passesSchool && passesRank;
            });

            displaySpells(filtered);
        }

        // Initialize the page by fetching data
        document.addEventListener('DOMContentLoaded', fetchSpells);
    </script>
</body>

</html>